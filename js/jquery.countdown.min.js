(function(n){n.fn.countdown=function(t,i){function w(n){n.id=="qstart"?(f=" secs to next question",e=" to next question",o=" to next question",s=" to next question",h="<span>Countdown before the<br/>next question is served up<\/span>",u="<span>Date that the<br/>next question is served up<\/span>"):(f=" secs to answer deadline",e=" to answer deadline",o=" to answer deadline",s=" to answer deadline",h="<span>Deadline countdown for an<br/>answer to be submitted<\/span>",u="<span>Deadline date for an<br/>answer to be submitted<\/span>")}function c(t,i,r){new Date(t).getTime()/1e3<i.warningSecs?n(".countdownStyle").css("color",i.warningColor):n(".countdownStyle").css("color",i.color);r.find(".days").css("background-color","black");r.find(".hours").css("background-color","black");r.find(".minutes").css("background-color","black");r.find(".seconds").css("background-color","black");r.css("text-shadow","0 0px 0")}function y(n,t,i,r,u){innerCountDownClockHtml='<li><span class="days"><\/span><\/li>                        <li id="clockSepD"><\/li>                        <li><span class="hours"><\/span><\/li>                        <li id="clockSepH"><\/li>                        <li><span class="minutes"><\/span><\/li>                        <li id="clockSepM"><\/li>                        <li><span class="seconds"><\/span><\/li>                        <li><span class="tailHtml"><\/span><\/li>';u.html(innerCountDownClockHtml);var s,h,c,o;s=n;h=String(i).length<=1&&n!=0?"0"+i:i;c=String(t).length<=1&&i!=0?"0"+t:t;o=String(r).length<=1&&t!=0?"0"+r:r;iSeparator=":";iDaySeparator=".";n==0?(u.find(".days").parent().remove(),u.find("#clockSepD").remove()):(u.find(".days").text(s+"d"),u.find("#clockSepD").text(iDaySeparator));n==0&&i==0?(u.find(".hours").parent().remove(),u.find("#clockSepH").remove()):(u.find(".hours").text(h+"h"),u.find("#clockSepH").text(iSeparator));n==0&&i==0&&t==0?(u.find(".minutes").parent().remove(),u.find("#clockSepM").remove()):(u.find(".minutes").text(c+"m"),u.find("#clockSepM").text(iSeparator));n>=1||i>=1||t>1?u.find(".seconds").text(o):u.find(".seconds").text(o);n!=0?u.find(".tailHtml").html(e):u.find(".tailHtml").html(f)}function b(){n("#popupClockCountdownTitle").html(h);n("#popupClockDateTitle").html(u);settingsDateLocal=new Date(r.date.getFullYear(),r.date.getMonth(),r.date.getDate(),r.date.getHours(),r.date.getMinutes()+r.date.getTimezoneOffset(),r.date.getSeconds());n("#popupClockDate").html("<span>"+GetInCommmonLocaleDateString(settingsDateLocal)+"<\/span><br/><span>"+GetInCommmonLocaleTimeString(settingsDateLocal)+"<\/span>")}function p(n,t,i,r,u){innerCountDownClockHtml='<li>                                    <span class="days">00<\/span>                                    <p class="days_ref">days<\/p>                                    <\/li>                                    <li class="seperator">.<\/li>                                    <li> <span class="hours">00<\/span>                                    <p class="hours_ref">hours<\/p>                                    <\/li>                                    <li class="seperator">:<\/li>                                    <li> <span class="minutes">00<\/span>                                    <p class="minutes_ref">minutes<\/p>                                    <\/li>                                    <li class="seperator">:<\/li>                                    <li> <span class="seconds">00<\/span>                                    <p class="seconds_ref">seconds<\/p>                                    <\/li>';u.html(innerCountDownClockHtml);var f,e,o,s;f=String(n).length>=2?n:"0"+n;e=String(i).length>=2?i:"0"+i;o=String(t).length>=2?t:"0"+t;s=String(r).length>=2?r:"0"+r;iSeparator=":";iDaySeparator=".";u.find(".days").text(f);u.find("#clockSepD").text(iDaySeparator);u.find(".hours").text(e);u.find("#clockSepH").text(iSeparator);u.find(".minutes").text(o);u.find("#clockSepM").text(iSeparator);u.find(".seconds").text(s)}function k(){var h=n("#"+a.attr("id")),f,w;if(r.auxId1!=null&&(f=n("#"+r.auxId1)),r.auxId2!=null&&(w=n("#"+r.auxId2)),n("#"+r.divAnchor).attr("countdown-enabled-"+r.id)!="true"){console.log("(id = "+r.id+") countdown aborted!!!!!");clearInterval(l);return}bufferDate=r.date;bufferTimeInMilliseconds=0;r.id=="qdeadline"&&(bufferDate=r.date-1e3*r.dateBufferSecs,bufferTimeInMilliseconds=1e3*r.bufferTimeSecs);var it=new Date(bufferDate),rt=v(),t=it-rt;if(t<0-bufferTimeInMilliseconds){clearInterval(l);n("#"+r.divAnchor).attr("countdown-enabled-"+r.id,"false");i&&typeof i=="function"&&i();return}if(t>=0){var nt=1e3,d=nt*60,g=d*60,tt=g*24,e=Math.floor(t/tt),b=Math.floor(t%tt/g),k=Math.floor(t%g/d),u=Math.floor(t%d/nt);r.clockInd&&(u>=60-r.dateViewSecs&&u<=59?(innerCountDownClockHtml='<li><span class="tailHtml"><\/span><\/li>',h.html(innerCountDownClockHtml),r.auxId1!=null&&f.html(innerCountDownClockHtml),tailHtmlDateNow=e!=0?s:o,settingsDateLocal=new Date(r.date.getFullYear(),r.date.getMonth(),r.date.getDate(),r.date.getHours(),r.date.getMinutes()+r.date.getTimezoneOffset(),r.date.getSeconds()),dateLocalStr=GetInCommmonLocaleDateString(settingsDateLocal)+" "+GetInCommmonLocaleTimeString(settingsDateLocal),h.find(".tailHtml").html('<span style="background-color:black">'+dateLocalStr+"<\/span>"+tailHtmlDateNow),r.auxId1!=null&&f.find(".tailHtml").html('<span style="background-color:black">'+dateLocalStr+"<\/span>"+tailHtmlDateNow),r.auxId2!=null&&p(e,k,b,u,w)):(y(e,k,b,u,h),r.auxId1!=null&&y(e,k,b,u,f),r.auxId2!=null&&p(e,k,b,u,w)),c(t,r,h),r.auxId1!=null&&c(t,r,f),r.auxId2!=null&&c(t,r,w),console.log("countdown:(id="+r.id+")"))}}var r=n.extend({id:null,divAnchor:null,date:null,dateBufferSecs:0,bufferTimeSecs:0,clockInd:!1,color:"#a7abb1",warningSecs:60,warningColor:"red",dateViewSecs:10,auxId1:null,auxId2:null},t),a,v,f,e,o,s,h,u,l;r.date||n.error("Date is not defined.");Date.parse(r.date)||n.error("Incorrect date format, it should look like this, 12/24/2012 12:00:00.");a=this;v=function(){var n=new Date;return new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()))};n("#"+r.divAnchor).attr("countdown-enabled-"+r.id,"true");u="";w(r);b();l=setInterval(k,1e3)}})(jQuery)